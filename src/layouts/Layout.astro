---
import { SEO, type Props as SEOProps } from "astro-seo";
import { ClientRouter } from "astro:transitions";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import ThemeToggle from "../components/ThemeToggle.astro";
import "@/styles/global.css";
import Posthog from "@/components/Posthog.astro";

interface Props {
  seo?: SEOProps;
  ogImage?: {
    template: string;
    data?: Record<string, any>;
  };
}

const { seo, ogImage } = Astro.props;

const ogImageUrl = "/og_image.png";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Trading-focused dark mode only - no theme switching needed -->
    <script is:inline>
      // Prevent flash of incorrect theme - must be first script
      (function () {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        document.documentElement.classList.toggle("dark", theme === "dark");
      })();
    </script>

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/favicon/site.webmanifest" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="generator" content={Astro.generator} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <meta
      name="keywords"
      content="josé donato, fullstack, openbb, quant, trading, tools, finance"
    />
    <Posthog />
    <SEO
      {...seo}
      title={seo?.title ?? "José Donato"}
      description={seo?.description ??
        "Fullstack Engineer from Portugal specializing in finance and quant trading tools. Working remotely at OpenBB."}
      openGraph={{
        basic: {
          type: "website",
          title: seo?.title ?? "José Donato",
          image: ogImageUrl,
          url: seo?.canonical,
        },
      }}
      twitter={{
        card: "summary_large_image",
        image: ogImageUrl,
      }}
    />
    <ClientRouter />
    <script is:inline>
      // Handle theme persistence with View Transitions
      document.addEventListener("astro:before-swap", (ev) => {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        ev.newDocument.documentElement.classList.toggle(
          "dark",
          theme === "dark",
        );
      });
    </script>
  </head>
  <body class="relative overflow-x-hidden">
    <!-- Ambient background -->
    <div class="fixed inset-0 bg-grid-pattern pointer-events-none"></div>
    <div class="fixed inset-0 bg-gradient-to-b from-bullish-500/5 via-transparent to-bullish-500/5 pointer-events-none"></div>

    <ThemeToggle />

    <main
      class="relative z-10 mx-auto max-w-(--breakpoint-md) px-4 sm:px-6 md:px-8 my-12 md:my-20"
    >
      <Header />
      <div class="min-h-[40vh]">
        <slot />
      </div>
      <Footer />
    </main>
  </body>
</html>
